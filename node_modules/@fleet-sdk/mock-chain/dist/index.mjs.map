{"version":3,"sources":["../src/objectMocking.ts","../src/execution.ts","../src/balancePrinting.ts","../src/mockUtxoCollection.ts","../src/party/mockChainParty.ts","../src/party/keyedMockChainParty.ts","../src/party/nonKeyedMockChainParty.ts","../src/mockChain.ts"],"names":["hex","SAFE_MIN_BOX_VALUE","randomBytes","ensureDefaults","isUndefined","log","pc","some"],"mappings":"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","file":"index.mjs","sourcesContent":["import type { Box } from \"@fleet-sdk/common\";\nimport { SAFE_MIN_BOX_VALUE } from \"@fleet-sdk/core\";\nimport { hex } from \"@fleet-sdk/crypto\";\nimport { blake2b256, randomBytes } from \"@fleet-sdk/crypto\";\nimport { serializeBox } from \"@fleet-sdk/serializer\";\nimport { AvlTree$, type BlockchainStateContext, GroupElement$ } from \"sigmastate-js/main\";\n\ntype MockBoxOptions = Partial<Omit<Box<bigint>, \"boxId\">> & {\n  ergoTree: string;\n};\n\nexport function mockUTxO(mock: MockBoxOptions): Box<bigint> {\n  const box: Box<bigint> = {\n    boxId: \"\",\n\n    value: mock.value ?? SAFE_MIN_BOX_VALUE,\n    ergoTree: mock.ergoTree,\n    assets: mock.assets ?? [],\n    creationHeight: mock.creationHeight ?? 0,\n    additionalRegisters: mock.additionalRegisters ?? {},\n\n    transactionId: mock.transactionId ?? getRandomId(),\n    index: mock.index ?? 0\n  };\n\n  const bytes = serializeBox(box).toBytes();\n  box.boxId = hex.encode(blake2b256(bytes));\n\n  return box;\n}\n\nfunction getRandomId() {\n  return hex.encode(randomBytes(32));\n}\n\nconst BLOCK_TIME = 2;\n\nexport type HeaderMockingOptions = {\n  parentId?: string;\n  version?: number;\n  fromHeight?: number;\n  fromTimestamp?: number;\n};\n\nexport type BlockchainContextMockingOptions = {\n  headers?: { quantity: number } & HeaderMockingOptions;\n};\n\nexport type PoWSolutions = { pk: string; w: string; n: string; d: string };\n\nexport type Header = {\n  id: string;\n  parentId: string;\n  version: number;\n  height: number;\n  adProofsRoot: string;\n  stateRoot: string;\n  transactionsRoot: string;\n  timestamp: number;\n  nBits: number;\n  extensionHash: string;\n  powSolutions: PoWSolutions;\n  votes: string;\n};\n\nexport function mockHeaders(count: number, options?: HeaderMockingOptions) {\n  const headers = new Array<Header>(count);\n  const height = (options?.fromHeight ?? 0) + count;\n  const timestamp = options?.fromTimestamp ? new Date(options.fromTimestamp) : new Date();\n  const version = options?.version ?? 3;\n  let parentId = options?.parentId || getRandomId();\n\n  for (let i = 0; i < count; i++) {\n    const id = getRandomId();\n    if (i > 0) timestamp.setMinutes(timestamp.getMinutes() - BLOCK_TIME);\n\n    headers[i] = {\n      id,\n      parentId,\n      version,\n      height: height - i,\n      adProofsRoot: \"094a38dca68383996db603b11d7a4a2c2ca2cfd45946208c89fdcf73fa4bed2f\",\n      stateRoot: \"6c64d4ffdf34b31b81c8fbb7cebb78ce12f5c7e5c61864c6523bf1481c8011c619\",\n      transactionsRoot:\n        \"0c9778e550d39b8423a2247a73a05169369054ef6edaf30f2842b223ed3cc450\",\n      timestamp: timestamp.getTime(),\n      nBits: 118081018,\n      extensionHash: \"33c61204c775128d6d19754d9be6b4c7ab06a2af7d8f95e6662df476a394be51\",\n      powSolutions: {\n        pk: \"0295facb78290ac2b55f1453204d49df37be5bae9f185ed6704c1ba3ee372280c1\",\n        w: \"0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798\",\n        n: \"712b000abb1f4e33\",\n        d: \"0\"\n      },\n      votes: \"000000\"\n    };\n\n    parentId = id;\n  }\n\n  return headers.reverse();\n}\n\nexport function mockBlockchainStateContext(options?: BlockchainContextMockingOptions) {\n  const headers = mockHeaders(\n    (options?.headers?.quantity ?? 10) + 1,\n    options?.headers\n  ).map((h) => ({\n    ...h,\n    ADProofsRoot: h.adProofsRoot,\n    stateRoot: AvlTree$.fromDigest(h.stateRoot),\n    timestamp: BigInt(h.timestamp),\n    nBits: BigInt(h.nBits),\n    extensionRoot: h.extensionHash,\n    minerPk: GroupElement$.fromPointHex(h.powSolutions.pk),\n    powOnetimePk: GroupElement$.fromPointHex(h.powSolutions.w),\n    powNonce: h.powSolutions.n,\n    powDistance: BigInt(h.powSolutions.d)\n  }));\n\n  return {\n    sigmaLastHeaders: headers.slice(1),\n    previousStateDigest: headers[1].stateRoot.digest,\n    sigmaPreHeader: headers[0]\n  } as BlockchainStateContext;\n}\n","import { ensureDefaults, Network } from \"@fleet-sdk/common\";\nimport type { ErgoUnsignedTransaction } from \"@fleet-sdk/core\";\nimport { bigintBE, hex } from \"@fleet-sdk/crypto\";\nimport type { ErgoHDKey } from \"@fleet-sdk/wallet\";\nimport {\n  type BlockchainParameters,\n  type BlockchainStateContext,\n  ProverBuilder$\n} from \"sigmastate-js/main\";\nimport { mockBlockchainStateContext } from \"./objectMocking\";\n\n/**\n * blockchain parameters at height 1283632\n */\nexport const BLOCKCHAIN_PARAMETERS: BlockchainParameters = {\n  storageFeeFactor: 1250000,\n  minValuePerByte: 360,\n  maxBlockSize: 1271009,\n  tokenAccessCost: 100,\n  inputCost: 2407,\n  dataInputCost: 100,\n  outputCost: 197,\n  maxBlockCost: 8001091,\n  blockVersion: 3\n};\n\nexport type TransactionExecutionResult = {\n  success: boolean;\n  reason?: string;\n};\n\nexport type ExecutionParameters = {\n  context?: BlockchainStateContext;\n  parameters?: BlockchainParameters;\n  network?: Network;\n  baseCost?: number;\n};\n\nexport function execute(\n  unsigned: ErgoUnsignedTransaction,\n  keys: ErgoHDKey[],\n  parameters?: ExecutionParameters\n): TransactionExecutionResult {\n  for (const key of keys) {\n    if (!key.hasPrivateKey()) {\n      throw new Error(\n        `ErgoHDKey '${hex.encode(key.publicKey)}' must have a private key.`\n      );\n    }\n  }\n\n  const eip12Tx = unsigned.toEIP12Object();\n  const params = ensureDefaults(parameters, {\n    context: mockBlockchainStateContext(),\n    parameters: BLOCKCHAIN_PARAMETERS,\n    network: Network.Mainnet,\n    baseCost: 0\n  });\n\n  try {\n    const builder = ProverBuilder$.create(params.parameters, params.network);\n    for (const key of keys) {\n      builder.withDLogSecret(bigintBE.encode(key.privateKey as Uint8Array));\n    }\n    const prover = builder.build();\n\n    const reducedTx = prover.reduce(\n      params.context,\n      eip12Tx,\n      eip12Tx.inputs,\n      eip12Tx.dataInputs,\n      unsigned.burning.tokens,\n      params.baseCost\n    );\n\n    prover.signReduced(reducedTx);\n\n    return { success: true };\n  } catch (e) {\n    return { success: false, reason: (e as Error).message };\n  }\n}\n","import { type Amount, decimalize, some } from \"@fleet-sdk/common\";\nimport { type ArrayChange, diffArrays } from \"diff\";\nimport pc from \"picocolors\";\nimport type { AssetMetadataMap } from \"./mockChain\";\nimport type { PartyBalance } from \"./party/mockChainParty\";\n\nconst ELLIPSIS = \"...\";\n\nexport function stringifyBalance(\n  balance: PartyBalance,\n  name: string,\n  width: number,\n  metadata?: AssetMetadataMap\n): string {\n  const tokenWidth = (width * 70) / 100;\n\n  const rows = [\n    line(\"-\", width),\n    center(compact(`- ${name} -`, width - 4), width),\n    line(\"-\", width),\n    between(\"Asset\", \"Balance\", width),\n    line(\"=\", width),\n    between(\n      metaName(\"nanoerg\", metadata),\n      metaAmount(\"nanoerg\", balance.nanoergs, metadata),\n      width\n    )\n  ];\n\n  if (some(balance.tokens)) {\n    for (const token of balance.tokens) {\n      rows.push(\n        between(\n          metaName(token.tokenId, metadata),\n          metaAmount(token.tokenId, token.amount, metadata),\n          width,\n          tokenWidth\n        )\n      );\n    }\n  }\n\n  rows.push(line(\"-\", width));\n\n  return rows.join(\"\\n\");\n}\n\nfunction metaName(key: string, metadata?: AssetMetadataMap) {\n  return metadata?.get(key)?.name || key;\n}\n\nfunction metaAmount(key: string, amount: Amount, metadata?: AssetMetadataMap) {\n  const decimals = metadata?.get(key)?.decimals;\n\n  if (decimals) {\n    return decimalize(amount, decimals);\n  }\n\n  return amount.toString();\n}\n\nexport function between(\n  leftStr: string,\n  rightStr: string,\n  length: number,\n  maxLeftLength?: number\n): string {\n  const rlen = length - rightStr.length - 1;\n  const r = compact(\n    leftStr,\n    maxLeftLength && maxLeftLength <= rlen ? maxLeftLength : rlen\n  );\n  const l = right(rightStr, length - r.length);\n\n  return r + l;\n}\n\nexport function printDiff(oldVal: string, newVal: string) {\n  const diff = diffArrays(oldVal.split(\"\\n\"), newVal.split(\"\\n\"));\n\n  diff.map((part) => part.value.map((row) => log(row, part)));\n}\n\nfunction log<T>(value: string, part: ArrayChange<T>) {\n  const colored = part.added\n    ? pc.green(`+ ${value}`)\n    : part.removed\n      ? pc.red(`- ${value}`)\n      : pc.gray(`  ${value}`);\n\n  // biome-ignore lint/suspicious/noConsoleLog: <explanation>\n  console.log(colored);\n}\n\nexport function line(char: string, length: number): string {\n  return maxLength(char.repeat(length), length);\n}\n\nexport function maxLength(str: string, length: number): string {\n  if (str.length < length) {\n    return str;\n  }\n\n  return str.slice(0, length);\n}\n\nexport function left(str: string, length: number): string {\n  return str.padEnd(length);\n}\n\nexport function right(str: string, length: number): string {\n  return str.padStart(length);\n}\n\nexport function center(str: string, length: number): string {\n  if (str.length > length) {\n    return str;\n  }\n\n  const half = (length + str.length) / 2;\n  return str.padStart(half).padEnd(length);\n}\n\nexport function compact(val: string, length: number): string {\n  if (length >= val.length) return val;\n  if (length <= 0) return \"\";\n  if (length <= ELLIPSIS.length + 2) return maxLength(val, length);\n\n  const fragmentSize = Math.trunc((length - ELLIPSIS.length) / 2);\n  return maxLength(\n    `${val.slice(0, fragmentSize).trimEnd()}${ELLIPSIS}${val\n      .slice(val.length - fragmentSize)\n      .trimStart()}`,\n    length\n  );\n}\n","import {\n  type Amount,\n  type Box,\n  type BoxCandidate,\n  type BoxId,\n  Collection,\n  ensureUTxOBigInt,\n  isUndefined,\n  type OneOrMore\n} from \"@fleet-sdk/common\";\nimport { isDefined } from \"@fleet-sdk/common\";\nimport { DuplicateInputError, NotFoundError } from \"@fleet-sdk/core\";\nimport { mockUTxO } from \"./objectMocking\";\nimport type { MockUTxOInput } from \"./party/mockChainParty\";\n\nfunction isUTxOCandidate(\n  candidate: BoxCandidate<Amount> | Box<Amount>\n): candidate is BoxCandidate<Amount> {\n  return isUndefined(candidate.boxId);\n}\n\nexport class MockUTxOCollection extends Collection<Box<bigint>, MockUTxOInput> {\n  constructor();\n  constructor(box: Box<Amount>);\n  constructor(boxes: Box<Amount>[]);\n  constructor(boxes?: OneOrMore<Box<Amount>>) {\n    super();\n\n    if (isDefined(boxes)) {\n      this.add(boxes);\n    }\n  }\n\n  protected override _map(utxo: BoxCandidate<Amount> | Box<Amount>): Box<bigint> {\n    if (isUTxOCandidate(utxo)) {\n      return mockUTxO(ensureUTxOBigInt(utxo));\n    }\n\n    return ensureUTxOBigInt(utxo);\n  }\n\n  protected override _addOne(utxo: Box<Amount>): number {\n    if (this._items.some((item) => item.boxId === utxo.boxId)) {\n      throw new DuplicateInputError(utxo.boxId);\n    }\n\n    return super._addOne(utxo);\n  }\n\n  public clear() {\n    this._items.length = 0;\n  }\n\n  public remove(boxId: BoxId): number;\n  public remove(index: number): number;\n  public remove(boxIdOrIndex: BoxId | number): number {\n    let index = -1;\n    if (typeof boxIdOrIndex === \"number\") {\n      if (this._isIndexOutOfBounds(boxIdOrIndex)) {\n        throw new RangeError(`Index '${boxIdOrIndex}' is out of range.`);\n      }\n\n      index = boxIdOrIndex;\n    } else {\n      index = this._items.findIndex((box) => box.boxId === boxIdOrIndex);\n\n      if (this._isIndexOutOfBounds(index)) {\n        throw new NotFoundError(\n          \"The UTxO you are trying to remove is not present in the UTxOs collection.\"\n        );\n      }\n    }\n\n    this._items.splice(index, 1);\n\n    return this.length;\n  }\n\n  public some(predicate: (item: Box<bigint>) => unknown): boolean {\n    return this._items.some(predicate);\n  }\n\n  public exists(boxId: string): boolean {\n    return this._items.some((x) => x.boxId === boxId);\n  }\n}\n","import {\n  type Amount,\n  type BoxCandidate,\n  type NonMandatoryRegisters,\n  type OneOrMore,\n  type TokenAmount,\n  utxoSum\n} from \"@fleet-sdk/common\";\nimport { type Box, type ErgoAddress, SAFE_MIN_BOX_VALUE } from \"@fleet-sdk/core\";\nimport { stringifyBalance } from \"../balancePrinting\";\nimport type { MockChain } from \"../mockChain\";\nimport { MockUTxOCollection } from \"../mockUtxoCollection\";\n\nexport type MockUTxOInput = OneOrMore<BoxCandidate<Amount>> | OneOrMore<Box<Amount>>;\n\nexport type AddBalance = {\n  nanoergs?: Amount;\n  tokens?: TokenAmount<Amount>[];\n};\n\nexport type PartyBalance = {\n  nanoergs: bigint;\n  tokens: TokenAmount<bigint>[];\n};\n\nexport abstract class MockChainParty {\n  private readonly _name?: string;\n  private readonly _utxos: MockUTxOCollection;\n  private readonly _address: ErgoAddress;\n  private readonly _ergoTree: string;\n  private readonly _chain: MockChain;\n\n  constructor(chain: MockChain, address: ErgoAddress, name?: string) {\n    this._chain = chain;\n    this._address = address;\n    this._name = name;\n\n    this._ergoTree = this._address.ergoTree;\n    this._utxos = new MockUTxOCollection();\n  }\n\n  get address(): ErgoAddress {\n    return this._address;\n  }\n\n  get name(): string {\n    return this._name || this._address.encode();\n  }\n\n  get utxos(): MockUTxOCollection {\n    return this._utxos;\n  }\n\n  get ergoTree(): string {\n    return this._ergoTree;\n  }\n\n  get chain(): MockChain {\n    return this._chain;\n  }\n\n  get balance(): PartyBalance {\n    const summary = utxoSum(this._utxos.toArray());\n\n    return { nanoergs: summary.nanoErgs, tokens: summary.tokens };\n  }\n\n  addUTxOs(utxos: MockUTxOInput): MockChainParty {\n    this._utxos.add(utxos);\n\n    return this;\n  }\n\n  /**\n   * Syntax sugar for `addUTxOs`\n   * @param utxos\n   * @returns\n   */\n  withUTxOs(utxos: MockUTxOInput): MockChainParty {\n    return this.addUTxOs(utxos);\n  }\n\n  addBalance(\n    balance: AddBalance,\n    additionalRegisters?: NonMandatoryRegisters\n  ): MockChainParty {\n    this.addUTxOs({\n      value: balance.nanoergs || SAFE_MIN_BOX_VALUE,\n      assets: balance.tokens || [],\n      ergoTree: this._ergoTree,\n      creationHeight: this._chain.height,\n      additionalRegisters: additionalRegisters || {}\n    });\n\n    return this;\n  }\n\n  /**\n   * Syntax sugar for `addBalance`\n   * @param utxos\n   * @returns\n   */\n  withBalance(\n    balance: AddBalance,\n    additionalRegisters?: NonMandatoryRegisters\n  ): MockChainParty {\n    return this.addBalance(balance, additionalRegisters);\n  }\n\n  toString(width = 50): string {\n    return stringifyBalance(this.balance, this.name, width, this._chain.assetsMetadata);\n  }\n}\n","import { randomBytes } from \"@fleet-sdk/crypto\";\nimport { ErgoHDKey } from \"@fleet-sdk/wallet\";\nimport type { MockChain } from \"../mockChain\";\nimport { MockChainParty } from \"./mockChainParty\";\n\nexport class KeyedMockChainParty extends MockChainParty {\n  private readonly _key: ErgoHDKey;\n\n  constructor(chain: MockChain, name?: string) {\n    const seed = randomBytes(32);\n    const key = ErgoHDKey.fromMasterSeed(seed);\n    super(chain, key.address, name);\n\n    this._key = key;\n  }\n\n  get key(): ErgoHDKey {\n    return this._key;\n  }\n}\n","import { assert, type HexString } from \"@fleet-sdk/common\";\nimport { ErgoAddress } from \"@fleet-sdk/core\";\nimport type { MockChain } from \"../mockChain\";\nimport { MockChainParty } from \"./mockChainParty\";\n\nexport class NonKeyedMockChainParty extends MockChainParty {\n  constructor(chain: MockChain, ergoTree: HexString, name?: string) {\n    assert(\n      typeof ergoTree === \"string\",\n      \"A non-keyed party needs a valid ErgoTree to be instantiated.\"\n    );\n\n    const address = ErgoAddress.fromErgoTree(ergoTree);\n    super(chain, address, name);\n  }\n}\n","import {\n  ensureDefaults,\n  first,\n  type HexString,\n  isUndefined,\n  some\n} from \"@fleet-sdk/common\";\nimport type { ErgoUnsignedTransaction } from \"@fleet-sdk/core\";\nimport { utf8 } from \"@fleet-sdk/crypto\";\nimport { decode } from \"@fleet-sdk/serializer\";\nimport pc from \"picocolors\";\nimport type { BlockchainParameters } from \"sigmastate-js/main\";\nimport { printDiff } from \"./balancePrinting\";\nimport { BLOCKCHAIN_PARAMETERS, execute } from \"./execution\";\nimport { mockBlockchainStateContext } from \"./objectMocking\";\nimport {\n  KeyedMockChainParty,\n  type MockChainParty,\n  NonKeyedMockChainParty\n} from \"./party\";\n\nconst BLOCK_TIME_MS = 120000;\n\nexport type AssetMetadata = {\n  name?: string;\n  decimals?: number;\n};\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport type AssetMetadataMap = Map<\"nanoerg\" | (string & {}), AssetMetadata>;\n\nexport type NonKeyedMockChainPartyOptions = {\n  name?: string;\n  ergoTree: string;\n};\n\nexport type TransactionExecutionOptions = {\n  signers?: KeyedMockChainParty[];\n  throw?: boolean;\n  log?: boolean;\n};\n\nexport type MockChainOptions = {\n  height?: number;\n  timestamp?: number;\n  parameters?: Partial<BlockchainParameters>;\n};\n\nexport type BlockState = {\n  height: number;\n  timestamp: number;\n  parameters: BlockchainParameters;\n};\n\nexport class MockChain {\n  readonly #parties: MockChainParty[];\n  readonly #tip: BlockState;\n  readonly #base: BlockState;\n  #metadataMap: AssetMetadataMap;\n\n  constructor();\n  constructor(height?: number);\n  constructor(options?: MockChainOptions);\n  constructor(heightOrOptions?: number | MockChainOptions) {\n    const options =\n      !heightOrOptions || typeof heightOrOptions === \"number\"\n        ? { height: heightOrOptions ?? 0 }\n        : heightOrOptions;\n\n    const state = ensureDefaults(options, {\n      height: 0,\n      timestamp: new Date().getTime(),\n      parameters: ensureDefaults(options.parameters, BLOCKCHAIN_PARAMETERS)\n    });\n\n    this.#tip = state;\n    this.#base = { ...state };\n    this.#parties = [];\n    this.#metadataMap = new Map();\n  }\n\n  get assetsMetadata(): AssetMetadataMap {\n    return this.#metadataMap;\n  }\n\n  get height(): number {\n    return this.#tip.height;\n  }\n\n  get timestamp(): number {\n    return this.#tip.timestamp;\n  }\n\n  get parties(): MockChainParty[] {\n    return this.#parties;\n  }\n\n  newBlock() {\n    this.newBlocks(1);\n  }\n\n  newBlocks(count: number) {\n    this.#tip.height += count;\n    this.#tip.timestamp += BLOCK_TIME_MS * count;\n  }\n\n  jumpTo(newHeight: number) {\n    this.newBlocks(newHeight - this.#tip.height);\n  }\n\n  clearUTxOSet() {\n    for (const party of this.#parties) {\n      party.utxos.clear();\n    }\n  }\n\n  reset() {\n    this.clearUTxOSet();\n    this.#tip.height = this.#base.height;\n    this.#tip.timestamp = this.#base.timestamp;\n  }\n\n  newParty(name?: string): KeyedMockChainParty;\n  newParty(nonKeyedOptions?: NonKeyedMockChainPartyOptions): NonKeyedMockChainParty;\n  newParty(optOrName?: string | NonKeyedMockChainPartyOptions): MockChainParty {\n    return this.#pushParty(\n      typeof optOrName === \"string\" || isUndefined(optOrName)\n        ? new KeyedMockChainParty(this, optOrName)\n        : new NonKeyedMockChainParty(this, optOrName.ergoTree, optOrName.name)\n    );\n  }\n\n  addParty(ergoTree: HexString, name?: string): NonKeyedMockChainParty {\n    return this.#pushParty(new NonKeyedMockChainParty(this, ergoTree, name));\n  }\n\n  #pushParty<T extends MockChainParty>(party: T): T {\n    this.#parties.push(party);\n\n    return party;\n  }\n\n  execute(\n    unsignedTransaction: ErgoUnsignedTransaction,\n    options?: TransactionExecutionOptions,\n    baseCost?: number\n  ): boolean {\n    const keys = (options?.signers || this.#parties)\n      .filter((p): p is KeyedMockChainParty => p instanceof KeyedMockChainParty)\n      .map((p) => p.key);\n\n    const context = mockBlockchainStateContext({\n      headers: {\n        quantity: 10,\n        fromHeight: this.#tip.height,\n        fromTimestamp: this.#tip.timestamp\n      }\n    });\n\n    const result = execute(unsignedTransaction, keys, {\n      context,\n      baseCost,\n      parameters: this.#tip.parameters\n    });\n\n    if (!result.success) {\n      if (options?.log) {\n        log(pc.red(`${pc.bgRed(pc.bold(\" Error \"))} ${result.reason}`));\n      }\n\n      if (options?.throw !== false) throw new Error(result.reason);\n      return false;\n    }\n\n    const preExecBalances = options?.log\n      ? this.#parties.map((party) => party.toString())\n      : undefined;\n\n    const { inputs, outputs } = unsignedTransaction.toPlainObject();\n    for (const party of this.#parties) {\n      for (let i = inputs.length - 1; i >= 0; i--) {\n        if (party.utxos.exists(inputs[i].boxId)) {\n          party.utxos.remove(inputs[i].boxId);\n        }\n      }\n\n      for (let i = outputs.length - 1; i >= 0; i--) {\n        if (party.ergoTree === outputs[i].ergoTree) {\n          party.utxos.add(outputs[i]);\n          outputs.splice(i, 1);\n        }\n      }\n    }\n\n    this.#pushMetadata(unsignedTransaction);\n\n    this.newBlock();\n\n    if (some(preExecBalances) && result.success) {\n      const postExecBalances = this.#parties.map((party) => party.toString());\n\n      log(\"State changes:\\n\");\n      for (let i = 0; i < preExecBalances.length; i++) {\n        printDiff(preExecBalances[i], postExecBalances[i]);\n        log(\"\\n\");\n      }\n    }\n\n    return true;\n  }\n\n  #pushMetadata(transaction: ErgoUnsignedTransaction) {\n    const firstInputId = first(transaction.inputs).boxId;\n    const box = transaction.outputs.find((output) =>\n      output.assets.some((asset) => asset.tokenId === firstInputId)\n    );\n    if (!box) return;\n\n    const name = decode(box.additionalRegisters.R4, safeUtf8Encode);\n    const decimals = decode(box.additionalRegisters.R6, safeUtf8Encode);\n    if (name) {\n      this.#metadataMap.set(firstInputId, {\n        name,\n        decimals: decimals ? Number.parseInt(decimals) : undefined\n      });\n    }\n  }\n}\n\nfunction log(str: string) {\n  // biome-ignore lint/suspicious/noConsoleLog: <explanation>\n  console.log(str);\n}\n\nconst safeUtf8Encode = (v: unknown) =>\n  v instanceof Uint8Array ? utf8.encode(v) : undefined;\n"]}